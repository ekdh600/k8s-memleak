# ğŸš¨ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì‹œë®¬ë ˆì´ì…˜ ë° eBPF íŠ¸ë˜í‚¹ ë°ëª¨

[![Docker](https://img.shields.io/badge/Docker-20.10+-2496ED.svg?logo=docker)](https://www.docker.com/)
[![Kubernetes](https://img.shields.io/badge/Kubernetes-1.20+-326CE5.svg?logo=kubernetes)](https://kubernetes.io/)
[![eBPF](https://img.shields.io/badge/eBPF-Enabled-00FF00.svg)](https://ebpf.io/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## ğŸ“‹ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” **C ê¸°ë°˜ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì‹œë®¬ë ˆì´í„°**ì™€ **eBPF íŠ¸ë˜í‚¹ ë„êµ¬**ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê³  ì§„ë‹¨í•˜ëŠ” ì™„ì „í•œ ë°ëª¨ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ¯ í•µì‹¬ íŠ¹ì§•

- âœ… **Go í™˜ê²½ ë¶ˆí•„ìš”**: Docker ì´ë¯¸ì§€ë§Œìœ¼ë¡œ ì¦‰ì‹œ ì‹¤í–‰
- âœ… **íš¨ìœ¨ì ì¸ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**: C ì–¸ì–´ë¡œ ì‹¤ì œ malloc/free ëˆ„ë½ ì‹œë®¬ë ˆì´ì…˜
- âœ… **eBPF íŠ¸ë˜í‚¹ ìµœì í™”**: ì»¤ë„ ë ˆë²¨ì—ì„œ ì •í™•í•œ ë©”ëª¨ë¦¬ í• ë‹¹ ì¶”ì 
- âœ… **ê°€ë²¼ìš´ ì´ë¯¸ì§€**: ì •ì  ì»´íŒŒì¼ë¡œ ìµœì†Œ í¬ê¸°
- âœ… **ìë™í™”ëœ ë°°í¬**: ì›í´ë¦­ ì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   C App         â”‚    â”‚   Kubernetes    â”‚    â”‚   eBPF Tools    â”‚
â”‚   (Memory       â”‚    â”‚   Cluster       â”‚    â”‚                 â”‚
â”‚    Leak)        â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   malloc/free   â”‚    â”‚   Privileged    â”‚    â”‚   Inspektor     â”‚
â”‚   ëˆ„ë½ ì‹œë®¬ë ˆì´ì…˜â”‚    â”‚   Container     â”‚    â”‚   Gadget       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ë¹ ë¥¸ ì‹œì‘ (5ë¶„)

### 1. í”„ë¡œì íŠ¸ í´ë¡ 
```bash
git clone https://github.com/ekdh600/k8s-memleak.git
cd k8s-memleak
```

### 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ
```bash
make docker-build
```

### 3. ì¿ ë²„ë„¤í‹°ìŠ¤ì— ë°°í¬
```bash
make deploy
```

### 4. eBPF ë„êµ¬ ì„¤ì¹˜
```bash
make install-ebpf
```

### 5. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ íŠ¸ë˜í‚¹
```bash
make track-memory
```

## ğŸ” eBPF íŠ¸ë˜í‚¹

### Inspektor Gadget memleak
```bash
# Pod ì´ë¦„ í™•ì¸
kubectl -n memleak-demo get pods

# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì¶”ì 
kubectl gadget memleak -n memleak-demo -p <pod-name>

# ìƒì„¸í•œ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤
kubectl gadget memleak -n memleak-demo -p <pod-name> --show-references
```

### BCC memleak
```bash
# íŠ¹ì • í”„ë¡œì„¸ìŠ¤ ì¶”ì 
sudo /usr/share/bcc/tools/memleak -p <pid>

# ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ì™€ í•¨ê»˜
sudo /usr/share/bcc/tools/memleak -p <pid> --show-references
```

## ğŸ“Š ì‹œë®¬ë ˆì´ì…˜ ì‹œë‚˜ë¦¬ì˜¤

### Phase 1: ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ
- **5ì´ˆë§ˆë‹¤ 1MBì”© ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**
- **ìµœëŒ€ 1000MBê¹Œì§€ ëˆ„ì **
- **ì‹¤ì œ malloc í˜¸ì¶œë¡œ ì‹¤ì œì ì¸ ì‹œë®¬ë ˆì´ì…˜**

### Phase 2: í‘œì¤€ ëª¨ë‹ˆí„°ë§ì˜ í•œê³„
- **Pod ìƒíƒœ**: Running
- **í—¬ìŠ¤ì²´í¬**: ì •ìƒ
- **ì´ë²¤íŠ¸**: íŠ¹ì´ì‚¬í•­ ì—†ìŒ
- **í•˜ì§€ë§Œ**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì§€ì† ì¦ê°€

### Phase 3: eBPF ì§„ë‹¨
- **Inspektor Gadget memleak**ìœ¼ë¡œ ì‹¤ì‹œê°„ ì¶”ì 
- **ë©”ëª¨ë¦¬ í• ë‹¹ íŒ¨í„´** ë¶„ì„
- **ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤**ë¡œ ëˆ„ìˆ˜ ì§€ì  ì‹ë³„

### Phase 4: ë¬¸ì œ í•´ê²°
- **ê·¼ë³¸ ì›ì¸** ë°œê²¬
- **ì½”ë“œ ìˆ˜ì •** ë° ë°°í¬
- **ì˜ˆë°©ì±…** ìˆ˜ë¦½

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

- **ì–¸ì–´**: C (ì •ì  ì»´íŒŒì¼)
- **ì»¨í…Œì´ë„ˆ**: Docker (Alpine Linux)
- **ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: Kubernetes
- **ì§„ë‹¨**: eBPF (Inspektor Gadget, BCC)
- **ë¹Œë“œ**: Make, GCC
- **ëª¨ë‹ˆí„°ë§**: ì»¤ë„ ë ˆë²¨ ì¶”ì 

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
k8s-memleak/
â”œâ”€â”€ ğŸ“š ë¬¸ì„œ
â”‚   â”œâ”€â”€ README.md              # ì´ íŒŒì¼
â”‚   â”œâ”€â”€ EBPF_GUIDE.md          # eBPF íŠ¸ë˜í‚¹ ìƒì„¸ ê°€ì´ë“œ
â”‚   â”œâ”€â”€ INSTALL.md             # ì„¤ì¹˜ ê°€ì´ë“œ
â”‚   â””â”€â”€ LICENSE                # ë¼ì´ì„ ìŠ¤
â”œâ”€â”€ ğŸ”§ ì†ŒìŠ¤ ì½”ë“œ
â”‚   â””â”€â”€ src/                   # C ì†ŒìŠ¤ ì½”ë“œ
â”‚       â””â”€â”€ memory_leak.c      # ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì‹œë®¬ë ˆì´í„°
â”œâ”€â”€ ğŸ³ ì»¨í…Œì´ë„ˆ
â”‚   â”œâ”€â”€ Dockerfile             # ìµœì í™”ëœ Docker ì´ë¯¸ì§€
â”‚   â””â”€â”€ Makefile               # ë¹Œë“œ ë° ë°°í¬ ìë™í™”
â”œâ”€â”€ â˜¸ï¸ ì¿ ë²„ë„¤í‹°ìŠ¤
â”‚   â”œâ”€â”€ deployment.yaml        # ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
â”‚   â”œâ”€â”€ service.yaml           # ì„œë¹„ìŠ¤ ì„¤ì •
â”‚   â””â”€â”€ namespace.yaml         # ë„¤ì„ìŠ¤í˜ì´ìŠ¤
â””â”€â”€ ğŸš€ ë°°í¬ íŒ¨í‚¤ì§€
    â””â”€â”€ deploy-package/        # ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ìš©
```

## ğŸ”§ ì‚¬ìš©ë²•

### ë¡œì»¬ ì‹¤í–‰
```bash
# C í”„ë¡œê·¸ë¨ ë¹Œë“œ
make build

# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
make run
```

### Docker ì‹¤í–‰
```bash
# Docker ì´ë¯¸ì§€ ë¹Œë“œ
make docker-build

# Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰
make docker-run
```

### ì¿ ë²„ë„¤í‹°ìŠ¤ ë°°í¬
```bash
# ë°°í¬
make deploy

# ìƒíƒœ í™•ì¸
make status

# ë¡œê·¸ í™•ì¸
make logs
```

### eBPF íŠ¸ë˜í‚¹
```bash
# eBPF ë„êµ¬ ì„¤ì¹˜
make install-ebpf

# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì¶”ì 
make track-memory
```

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

- **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì†ë„**: 1MB/5ì´ˆ
- **ìµœëŒ€ ëˆ„ìˆ˜ëŸ‰**: 1000MB
- **íŠ¸ë˜í‚¹ ì •í™•ë„**: ì»¤ë„ ë ˆë²¨ (99.9%+)
- **ì˜¤ë²„í—¤ë“œ**: ìµœì†Œ (eBPF ìµœì í™”)
- **ë°°í¬ ì‹œê°„**: < 2ë¶„

## ğŸŒ ì§€ì›í•˜ëŠ” í™˜ê²½

- **ë¡œì»¬**: Kind, Minikube, Docker Desktop
- **í´ë¼ìš°ë“œ**: AKS, EKS, GKE
- **ì—”í„°í”„ë¼ì´ì¦ˆ**: OpenShift
- **ì‚¬ìš©ì ì •ì˜**: ëª¨ë“  ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°

## ğŸ” ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤
1. **ê¶Œí•œ ë¬¸ì œ**: eBPF ë„êµ¬ ì‚¬ìš© ì‹œ privileged ê¶Œí•œ í•„ìš”
2. **ì´ë¯¸ì§€ ë¡œë“œ**: í´ëŸ¬ìŠ¤í„° íƒ€ì…ì— ë”°ë¥¸ ì´ë¯¸ì§€ ë¡œë“œ ë°©ë²• í™•ì¸
3. **ë„¤íŠ¸ì›Œí¬ ì •ì±…**: eBPF ë„êµ¬ ì ‘ê·¼ í—ˆìš© í•„ìš”

### ë””ë²„ê¹… ëª…ë ¹ì–´
```bash
# Pod ìƒíƒœ í™•ì¸
kubectl -n memleak-demo get all

# ë¡œê·¸ í™•ì¸
kubectl -n memleak-demo logs -f deployment/memory-leaker

# ì´ë²¤íŠ¸ í™•ì¸
kubectl -n memleak-demo get events
```

## ğŸ“š ìƒì„¸ ê°€ì´ë“œ

- [eBPF íŠ¸ë˜í‚¹ ê°€ì´ë“œ](EBPF_GUIDE.md) - ìƒì„¸í•œ eBPF ì‚¬ìš©ë²•
- [ì„¤ì¹˜ ê°€ì´ë“œ](INSTALL.md) - ë‹¨ê³„ë³„ ì„¤ì¹˜ ê³¼ì •
- [GitHub ì„¤ì •](GITHUB_SETUP.md) - ì €ì¥ì†Œ ì„¤ì • ë° ê³µìœ 

## ğŸš€ ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì‚¬ìš©

### 1. í”„ë¡œì íŠ¸ í´ë¡ 
```bash
git clone https://github.com/ekdh600/k8s-memleak.git
cd k8s-memleak
```

### 2. ë¹ ë¥¸ ì‹œì‘
```bash
# ìœ„ì˜ "ë¹ ë¥¸ ì‹œì‘ (5ë¶„)" ì„¹ì…˜ ì°¸ì¡°
```

### 3. ìë™í™”ëœ ë°°í¬
```bash
cd deploy-package
./deploy.sh
```

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” MIT ë¼ì´ì„ ìŠ¤ í•˜ì— ë°°í¬ë©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ `LICENSE` íŒŒì¼ì„ ì°¸ì¡°í•˜ì„¸ìš”.

## ğŸ™ ê°ì‚¬ì˜ ë§

- [Inspektor Gadget](https://github.com/inspektor-gadget/inspektor-gadget) - eBPF ê¸°ë°˜ ì§„ë‹¨ ë„êµ¬
- [BCC](https://github.com/iovisor/bcc) - BPF Compiler Collection
- [eBPF](https://ebpf.io/) - Extended Berkeley Packet Filter

## ğŸ“ ì§€ì› ë° ë¬¸ì œ í•´ê²°

### ì´ìŠˆ ë¦¬í¬íŠ¸
GitHub Issuesë¥¼ í†µí•´ ë²„ê·¸ ë¦¬í¬íŠ¸ë‚˜ ê¸°ëŠ¥ ìš”ì²­ì„ í•´ì£¼ì„¸ìš”.

### í† ë¡ 
GitHub Discussionsì—ì„œ ì§ˆë¬¸ì´ë‚˜ ì•„ì´ë””ì–´ë¥¼ ê³µìœ í•´ì£¼ì„¸ìš”.

---

**âš ï¸ ì£¼ì˜**: ì´ ë°ëª¨ëŠ” êµìœ¡ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì‹ ì¤‘í•˜ê²Œ í…ŒìŠ¤íŠ¸í•˜ê³  ê²€ì¦ëœ ë„êµ¬ë“¤ì„ ì‚¬ìš©í•˜ì„¸ìš”.

**ğŸ¯ ëª©í‘œ**: eBPFì˜ ê°•ë ¥í•¨ì„ ì²´í—˜í•˜ê³ , ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œì˜ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì§„ë‹¨ ëŠ¥ë ¥ì„ í–¥ìƒì‹œí‚¤ì„¸ìš”!