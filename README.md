# ğŸš¨ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì‹œë®¬ë ˆì´ì…˜ ë° ì§„ë‹¨ ë°ëª¨

[![Go Version](https://img.shields.io/badge/Go-1.22+-blue.svg)](https://golang.org/)
[![Kubernetes](https://img.shields.io/badge/Kubernetes-1.20+-326CE5.svg?logo=kubernetes)](https://kubernetes.io/)
[![Docker](https://img.shields.io/badge/Docker-20.10+-2496ED.svg?logo=docker)](https://www.docker.com/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## ğŸ“‹ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê³ , eBPF ê¸°ë°˜ ì§„ë‹¨ ë„êµ¬ë“¤ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ ì¶”ì í•˜ëŠ” ì™„ì „í•œ ë°ëª¨ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤.



## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Go App       â”‚    â”‚   Kubernetes    â”‚    â”‚   Monitoring    â”‚
â”‚   (Memory      â”‚    â”‚   Cluster       â”‚    â”‚   Stack         â”‚
â”‚    Leak)       â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   pprof        â”‚    â”‚   eBPF          â”‚    â”‚   Prometheus    â”‚
â”‚   Heap Profile â”‚    â”‚   memleak       â”‚    â”‚   + Grafana     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. í”„ë¡œì íŠ¸ í´ë¡ 
```bash
git clone https://github.com/ekdh600/k8s-memleak.git
cd memory-leak-demo
```

### 2. ì‚¬ì „ ìš”êµ¬ì‚¬í•­ í™•ì¸
```bash
# Go ì„¤ì¹˜ í™•ì¸
go version

# Docker ì„¤ì¹˜ í™•ì¸
docker --version

# kubectl ì„¤ì¹˜ í™•ì¸
kubectl version --client
```

### 3. ë¡œì»¬ í™˜ê²½ì—ì„œ ì‹¤í–‰
```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
go mod tidy

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
go build -o app main.go

# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
./app
```

### 4. í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
go test -v

# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°ì§€ ìŠ¤í¬ë¦½íŠ¸
chmod +x ci/leak_check.sh
./ci/leak_check.sh
```

### 5. ì¿ ë²„ë„¤í‹°ìŠ¤ í™˜ê²½ì—ì„œ ì‹¤í–‰
```bash
# ë°°í¬ íŒ¨í‚¤ì§€ ì‚¬ìš© (ê¶Œì¥)
cd deploy-package
./scripts/setup-cluster.sh
./deploy.sh

# ë˜ëŠ” ìˆ˜ë™ ë°°í¬
docker build -t memleak:latest .
kubectl apply -f k8s/
```

## ğŸ” ì§„ë‹¨ ë„êµ¬ë“¤

### 1. í‘œì¤€ ëª¨ë‹ˆí„°ë§ (í•œê³„ì  ì‹œì—°)
- **Prometheus**: ê¸°ë³¸ ë©”íŠ¸ë¦­ë§Œ ìˆ˜ì§‘
- **Grafana**: ëŒ€ì‹œë³´ë“œì—ì„œ "ì •ìƒ" í‘œì‹œ
- **Kubernetes**: Pod ìƒíƒœ Running, ì´ë²¤íŠ¸ ì—†ìŒ

### 2. eBPF ê¸°ë°˜ ì§„ë‹¨
```bash
# Inspektor Gadget ì„¤ì¹˜
kubectl apply -f https://raw.githubusercontent.com/inspektor-gadget/inspektor-gadget/main/deploy/gadget.yaml

# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì¶”ì 
kubectl gadget memleak -n memleak-demo -p <pod-name>

# ì§„ë‹¨ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
chmod +x scripts/ebpf-memleak.sh
./scripts/ebpf-memleak.sh
```

### 3. pprof í™ í”„ë¡œíŒŒì¼
```bash
# í™ í”„ë¡œíŒŒì¼ ìˆ˜ì§‘
curl http://localhost:6060/debug/pprof/heap > heap.pb

# í”„ë¡œíŒŒì¼ ë¶„ì„
go tool pprof -top heap.pb
```

## ğŸ“Š ì‹œì—° ì‹œë‚˜ë¦¬ì˜¤

### Phase 1: í‘œë©´ì  ì •ìƒ
- ëª¨ë“  ëª¨ë‹ˆí„°ë§ ë„êµ¬ê°€ "ì •ìƒ" ì‹ í˜¸
- Pod ìƒíƒœ Running, ì´ë²¤íŠ¸ ì—†ìŒ
- í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°œìƒ

### Phase 2: ë¬¸ì œ ì¸ì‹
- ì‚¬ìš©ì ë¶ˆë§Œ ì¦ê°€
- Pod ì¬ì‹œì‘ ì‹œ ì ê¹ ì •ìƒ, 1-2ì‹œê°„ í›„ ë©”ëª¨ë¦¬ í­ì¦
- í‘œì¤€ í—¬ìŠ¤ì²´í¬ëŠ” ì—¬ì „íˆ "ì •ìƒ"

### Phase 3: eBPF ì§„ë‹¨
- Inspektor Gadget memleak ë„êµ¬ ì‚¬ìš©
- ì‹¤ì‹œê°„ ë©”ëª¨ë¦¬ í• ë‹¹/í•´ì œ ì¶”ì 
- íŠ¹ì • í”„ë¡œì„¸ìŠ¤ì˜ ë¹„ì •ìƒ íŒ¨í„´ ë°œê²¬

### Phase 4: ê·¼ë³¸ ì›ì¸ ë°œê²¬
- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ˆì™¸ ì²˜ë¦¬ ë²„ê·¸
- ë©”ëª¨ë¦¬ í•´ì œ ëˆ„ë½ íŒ¨í„´ ì‹ë³„
- ì½”ë“œ ìˆ˜ì • ë° ë°°í¬

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

- **ì–¸ì–´**: Go 1.22
- **ì»¨í…Œì´ë„ˆ**: Docker
- **ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜**: Kubernetes
- **ëª¨ë‹ˆí„°ë§**: Prometheus + Grafana
- **ì§„ë‹¨**: eBPF (Inspektor Gadget)
- **í”„ë¡œíŒŒì¼ë§**: pprof
- **CI/CD**: GitHub Actions

## ğŸ“š í•™ìŠµ í¬ì¸íŠ¸

1. **í‘œì¤€ ëª¨ë‹ˆí„°ë§ì˜ í•œê³„**: ëŒ€ì‹œë³´ë“œì˜ "ì •ìƒ" ì‹ í˜¸ì— ì•ˆì£¼í•˜ì§€ ë§ ê²ƒ
2. **eBPFì˜ ì¤‘ìš”ì„±**: ì»¤ë„ ë ˆë²¨ì—ì„œì˜ ì‹¤ì‹œê°„ ì¶”ì 
3. **ì§‘ìš”í•œ ë¬¸ì œ ì¶”ì **: ì¶”ìƒì  ì¦ìƒì„ ë„˜ì–´ ì‹œìŠ¤í…œ ë ˆë²¨ê¹Œì§€ íŒŒê³ ë“¤ ê²ƒ
4. **ìë™í™”ëœ ê²€ì¦**: CI/CDì— ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì²´í¬ í¬í•¨

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

1. **ê¶Œí•œ ë¬¸ì œ**: eBPF ë„êµ¬ ì‚¬ìš© ì‹œ privileged ê¶Œí•œ í•„ìš”
2. **ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨**: Kind í´ëŸ¬ìŠ¤í„°ì— ì´ë¯¸ì§€ ë¡œë“œ í™•ì¸
3. **í¬íŠ¸ ì¶©ëŒ**: 6060 í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸

### ë””ë²„ê¹… ëª…ë ¹ì–´

```bash
# Pod ë¡œê·¸ í™•ì¸
kubectl -n memleak-demo logs -f deployment/leaky

# Pod ìƒíƒœ ìƒì„¸ í™•ì¸
kubectl -n memleak-demo describe pod -l app=leaky

# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
kubectl -n memleak-demo exec -it $(kubectl -n memleak-demo get pod -l app=leaky -o jsonpath='{.items[0].metadata.name}') -- top
```

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

- **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì†ë„**: 1MB/5ì´ˆ
- **íƒì§€ ì„ê³„ê°’**: 20MB (RSS ì¦ê°€)
- **pprof ìˆ˜ì§‘ ì£¼ê¸°**: 10ì´ˆ
- **eBPF ì¶”ì  ì‹œê°„**: 5ë¶„

## ğŸš€ ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì‚¬ìš©

### 1. Gitì„ í†µí•œ ë°°í¬
```bash
# ì›ê²© ì €ì¥ì†Œì—ì„œ í´ë¡ 
git clone <repository-url>
cd memory-leak-demo

# ë°°í¬ íŒ¨í‚¤ì§€ ì‚¬ìš©
cd deploy-package
./scripts/setup-cluster.sh
./deploy.sh
```

### 2. ì§€ì›í•˜ëŠ” í´ëŸ¬ìŠ¤í„° íƒ€ì…
- **ë¡œì»¬**: Kind, Minikube, Docker Desktop
- **í´ë¼ìš°ë“œ**: AKS, EKS, GKE
- **ì—”í„°í”„ë¼ì´ì¦ˆ**: OpenShift
- **ì‚¬ìš©ì ì •ì˜**: ì‚¬ìš©ì ì •ì˜ í´ëŸ¬ìŠ¤í„°

### 3. ìë™í™”ëœ ë°°í¬
- í´ëŸ¬ìŠ¤í„° íƒ€ì… ìë™ ê°ì§€
- í™˜ê²½ë³„ ìµœì í™”ëœ ì„¤ì •
- ì›í´ë¦­ ë°°í¬ ë° ì •ë¦¬

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
memory-leak-demo/
â”œâ”€â”€ README.md                 # ì´ íŒŒì¼
â”œâ”€â”€ main.go                   # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ leak_test.go             # í…ŒìŠ¤íŠ¸ íŒŒì¼
â”œâ”€â”€ go.mod                   # Go ëª¨ë“ˆ ì •ì˜
â”œâ”€â”€ Dockerfile               # Docker ì´ë¯¸ì§€ ì •ì˜
â”œâ”€â”€ Makefile                 # ë¹Œë“œ ë° ë°°í¬ ëª…ë ¹ì–´
â”œâ”€â”€ ci/                      # CI/CD ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ leak_check.sh       # ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°ì§€
â”œâ”€â”€ scripts/                  # ìœ í‹¸ë¦¬í‹° ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ ebpf-memleak.sh     # eBPF ì§„ë‹¨
â”‚   â””â”€â”€ monitor-memory.sh   # ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§
â”œâ”€â”€ k8s/                     # ì¿ ë²„ë„¤í‹°ìŠ¤ ë§¤ë‹ˆí˜ìŠ¤íŠ¸
â”‚   â”œâ”€â”€ namespace.yaml       # ë„¤ì„ìŠ¤í˜ì´ìŠ¤
â”‚   â”œâ”€â”€ deployment.yaml      # ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬
â”‚   â”œâ”€â”€ service.yaml         # ì„œë¹„ìŠ¤
â”‚   â”œâ”€â”€ ingress.yaml         # ì¸ê·¸ë ˆìŠ¤
â”‚   â””â”€â”€ prometheus-config.yaml # Prometheus ì„¤ì •
â”œâ”€â”€ deploy-package/           # ë°°í¬ íŒ¨í‚¤ì§€
â”‚   â”œâ”€â”€ deploy.sh            # ë©”ì¸ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ scripts/             # ë°°í¬ ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸
â”‚   â””â”€â”€ k8s/                 # ì¿ ë²„ë„¤í‹°ìŠ¤ ë§¤ë‹ˆí˜ìŠ¤íŠ¸
â””â”€â”€ .github/                  # GitHub Actions
    â””â”€â”€ workflows/            # CI/CD ì›Œí¬í”Œë¡œìš°
        â””â”€â”€ leak-check.yml   # ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì²´í¬
```

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” MIT ë¼ì´ì„ ìŠ¤ í•˜ì— ë°°í¬ë©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ `LICENSE` íŒŒì¼ì„ ì°¸ì¡°í•˜ì„¸ìš”.

## ğŸ™ ê°ì‚¬ì˜ ë§

- [Inspektor Gadget](https://github.com/inspektor-gadget/inspektor-gadget) - eBPF ê¸°ë°˜ ì§„ë‹¨ ë„êµ¬
- [Go pprof](https://pkg.go.dev/runtime/pprof) - Go í”„ë¡œíŒŒì¼ë§ ë„êµ¬
- [Kubernetes](https://kubernetes.io/) - ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

## ğŸ“ ì§€ì› ë° ë¬¸ì œ í•´ê²°

### ì´ìŠˆ ë¦¬í¬íŠ¸
GitHub Issuesë¥¼ í†µí•´ ë²„ê·¸ ë¦¬í¬íŠ¸ë‚˜ ê¸°ëŠ¥ ìš”ì²­ì„ í•´ì£¼ì„¸ìš”.

### í† ë¡ 
GitHub Discussionsì—ì„œ ì§ˆë¬¸ì´ë‚˜ ì•„ì´ë””ì–´ë¥¼ ê³µìœ í•´ì£¼ì„¸ìš”.

### ë¬¸ì„œ
ìì„¸í•œ ì‚¬ìš©ë²•ì€ [Wiki](../../wiki)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

---

**âš ï¸ ì£¼ì˜**: ì´ ë°ëª¨ëŠ” êµìœ¡ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì‹ ì¤‘í•˜ê²Œ í…ŒìŠ¤íŠ¸í•˜ê³  ê²€ì¦ëœ ë„êµ¬ë“¤ì„ ì‚¬ìš©í•˜ì„¸ìš”.